<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Agent</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        #sn_va_web_client {
            width: 100%;
            height: 100vh;
            border: none;
        }
    </style>
    <script src="https://openteccomputaosistemasltdademo4.service-now.com/scripts/now-requestor-chat-popover-app/now-requestor-chat-popover-app.min.js?sysparm_substitute=false"></script>
</head>
<body>
    <iframe id="sn_va_web_client"
        title="ServiceNow Virtual Agent Client"
        src="https://openteccomputaosistemasltdademo4.servicenow.com/sn_va_web_client_app__embed.do"
        loading="lazy">
    </iframe>

    <script>
        const chat = new ServiceNowChat({
            instance: 'https://openteccomputaosistemasltdademo4.service-now.com',
            context: {
                skip_load_history: 1
            },
            branding: {
                bgColor: '#333',
                primaryColor: '#000',
                hoverColor: '#EFEFEF',
                activeColor: '#AAA',
                openIcon: 'custom-open.svg',
                closeIcon: 'custom-close.svg',
                sizeMultiplier: 1.6
            },
            offsetX: 50,
            offsetY: 50,
            position: 'left',
            translations: {
                'Open dialog': 'Open chat',
                'Open Chat. {0} unread message(s)': 'Click to open',
                'Close chat.': 'Click to close'
            }
        });

        // Add event listener for session events
        window.addEventListener("message", function(e) {
            // Check if it's a SESSION_CREATED event and the user is unauthenticated
            if (e.data.type === "SESSION_CREATED" && e.data.authenticated === false) {
                // Redirect to SSO login with the specified redirect URI
                window.location.href = "https://openteccomputaosistemasltdademo4.service-now.com/sn_va_web_client_login.do?sysparm_redirect_uri=" + encodeURIComponent(window.location.href);
            }

            // Check if it's a SESSION_LOGGED_OUT event
            if (e.data.type === "SESSION_LOGGED_OUT") {
                // Redirect to SSO login with the specified redirect URI
                window.location.href = "https://openteccomputaosistemasltdademo4.service-now.com/sn_va_web_client_login.do?sysparm_redirect_uri=" + encodeURIComponent(window.location.href);
            }
        });
    </script>
</body>
</html>
